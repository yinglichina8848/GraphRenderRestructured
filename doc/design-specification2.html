<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>design-specification2</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">design-specification2</h1>
</header>
<p>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ æ¶æ„è®¾è®¡è§„èŒƒ â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›</p>
<ol type="1">
<li>æ–‡æ¡£æ¦‚è¿°</li>
</ol>
<p>æœ¬æ–‡æ¡£å®šä¹‰äº†å›¾å½¢æ¸²æŸ“ç³»ç»Ÿçš„æ¶æ„è®¾è®¡è§„èŒƒå’Œæ ‡å‡†ï¼Œç¡®ä¿ç³»ç»Ÿå¼€å‘éµå¾ªç»Ÿä¸€çš„è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µã€‚</p>
<ol start="2" type="1">
<li>è®¾è®¡åŸåˆ™</li>
</ol>
<p>2.1 æ ¸å¿ƒåŸåˆ™</p>
<p>1 å•ä¸€èŒè´£åŸåˆ™ (SRP)<br />
â€¢ æ¯ä¸ªç±»/æ¨¡å—åªæ‰¿æ‹…ä¸€ä¸ªæ˜ç¡®çš„èŒè´£<br />
â€¢ ç¤ºä¾‹ï¼šRendereråªè´Ÿè´£æ¸²æŸ“ï¼ŒShapeåªå®šä¹‰å›¾å½¢å±æ€§<br />
2 å¼€é—­åŸåˆ™ (OCP)<br />
â€¢ é€šè¿‡æ‰©å±•è€Œéä¿®æ”¹æ¥å¢åŠ æ–°åŠŸèƒ½<br />
â€¢ ç¤ºä¾‹ï¼šé€šè¿‡å®ç°Rendereræ¥å£æ·»åŠ æ–°æ¸²æŸ“å™¨<br />
3 ä¾èµ–å€’ç½®åŸåˆ™ (DIP)<br />
â€¢ é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡<br />
â€¢ ç¤ºä¾‹ï¼šUIå±‚é€šè¿‡Rendereræ¥å£ä½¿ç”¨æ¸²æŸ“åŠŸèƒ½</p>
<p>2.2 è¡¥å……åŸåˆ™</p>
<p>1 æœ€å°‘çŸ¥è¯†åŸåˆ™<br />
â€¢ æ¨¡å—åªä¸ç›´æ¥æœ‹å‹é€šä¿¡<br />
â€¢ ç¤ºä¾‹ï¼šCommandä¸éœ€è¦çŸ¥é“DrawingPanelå†…éƒ¨å®ç°<br />
2 çº¦å®šä¼˜äºé…ç½®<br />
â€¢ é‡‡ç”¨åˆç†çš„é»˜è®¤å€¼å‡å°‘é…ç½®<br />
â€¢ ç¤ºä¾‹ï¼šRendererFactoryå†…ç½®é»˜è®¤æ¸²æŸ“å™¨</p>
<ol start="3" type="1">
<li>åˆ†å±‚è§„èŒƒ</li>
</ol>
<p>3.1 å±‚æ¬¡å®šä¹‰</p>
<p>å±‚çº§ ç»„ä»¶ç¤ºä¾‹ èŒè´£ å…è®¸ä¾èµ–<br />
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è¡¨ç°å±‚ SwingUI, DrawingPanel ç”¨æˆ·äº¤äº’å’Œå±•ç¤º ä¸šåŠ¡é€»è¾‘å±‚<br />
ä¸šåŠ¡é€»è¾‘å±‚ Command, UndoManager æ ¸å¿ƒä¸šåŠ¡æµç¨‹ æœåŠ¡å±‚ã€é¢†åŸŸå±‚<br />
æœåŠ¡å±‚ RendererFactory, ShapeFactory æŠ€æœ¯æœåŠ¡æä¾› é¢†åŸŸå±‚<br />
é¢†åŸŸå±‚ Shape, Renderer æ ¸å¿ƒä¸šåŠ¡æ¨¡å‹ æ— <br />
åŸºç¡€è®¾æ–½å±‚ PersistenceManager æŠ€æœ¯å®ç°ç»†èŠ‚ è¢«å„å±‚ä¾èµ–</p>
<p>3.2 å±‚é—´é€šä¿¡è§„åˆ™</p>
<p>1 ä¸¥æ ¼åˆ†å±‚ï¼šåªå…è®¸ä¸Šå±‚è°ƒç”¨ä¸‹å±‚<br />
2 è·¨å±‚è°ƒç”¨ï¼šå¿…é¡»é€šè¿‡æ¥å£æŠ½è±¡<br />
3 æ•°æ®ä¼ é€’ï¼šä½¿ç”¨DTOè€Œéé¢†åŸŸå¯¹è±¡è·¨å±‚</p>
<ol start="4" type="1">
<li>æ¨¡å—è®¾è®¡è§„èŒƒ</li>
</ol>
<p>4.1 æ¨¡å—åˆ’åˆ†æ ‡å‡†</p>
<p>1 åŠŸèƒ½å†…èšï¼šç›¸å…³åŠŸèƒ½æ”¾åœ¨åŒä¸€æ¨¡å—<br />
â€¢ ç¤ºä¾‹ï¼šæ‰€æœ‰æ¸²æŸ“å™¨å®ç°åœ¨bridgeæ¨¡å—<br />
2 å˜æ›´éš”ç¦»ï¼šå¯èƒ½åŒæ—¶å˜æ›´çš„å†…å®¹æ”¾åœ¨ä¸€èµ·<br />
â€¢ ç¤ºä¾‹ï¼šlegacyæ¨¡å—éš”ç¦»æ—§ç‰ˆä»£ç <br />
3 å¤ç”¨ç²’åº¦ï¼šæŒ‰å¤ç”¨éœ€æ±‚åˆ’åˆ†æ¨¡å—<br />
â€¢ ç¤ºä¾‹ï¼šcoreæ¨¡å—åŒ…å«å¯å¤ç”¨åŸºç¡€è®¾æ–½</p>
<p>4.2 æ¨¡å—ä¾èµ–è§„åˆ™</p>
<p>graph TD<br />
ui â€“&gt; core<br />
ui â€“&gt; bridge<br />
command â€“&gt; core<br />
bridge â€“&gt; legacy<br />
factory â€“&gt; core<br />
persistence â€“&gt; factory</p>
<ol start="5" type="1">
<li>æ¥å£è®¾è®¡è§„èŒƒ</li>
</ol>
<p>5.1 æ¥å£å®šä¹‰è¦æ±‚</p>
<p>1 æ˜ç¡®èŒè´£ï¼š</p>
<p>/**<br />
* å›¾å½¢æ¸²æŸ“æ¥å£<br />
* <span class="citation" data-cites="implSpec">@implSpec</span>
å®ç°ç±»å¿…é¡»ä¿è¯çº¿ç¨‹å®‰å…¨<br />
*/<br />
public interface Renderer {<br />
void drawCircle(int x, int y, int radius);<br />
}</p>
<p>2 å‚æ•°æ ¡éªŒï¼š</p>
<p>default void drawCircle(int x, int y, int radius) {<br />
Objects.requireNonNull(renderer);<br />
if (radius &lt;= 0) throw new IllegalArgumentException();<br />
// å®é™…å®ç°<br />
}</p>
<p>5.2 æ¥å£æ¼”åŒ–ç­–ç•¥</p>
<p>1 æ–°å¢æ–¹æ³•ï¼šä½¿ç”¨é»˜è®¤å®ç°ä¿æŒå…¼å®¹<br />
2 æ–¹æ³•å¼ƒç”¨ï¼šç”¨@Deprecatedæ ‡æ³¨å¹¶è¯´æ˜æ›¿ä»£æ–¹æ¡ˆ<br />
3 é‡å¤§å˜æ›´ï¼šåˆ›å»ºæ–°æ¥å£ç‰ˆæœ¬</p>
<ol start="6" type="1">
<li>ç±»è®¾è®¡è§„èŒƒ</li>
</ol>
<p>6.1 ç±»èŒè´£çŸ©é˜µ</p>
<p>ç±»åˆ« ç¤ºä¾‹ èŒè´£æ•°é‡ æ–¹æ³•æ•°é‡ å±æ€§æ•°é‡<br />
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” æ§åˆ¶ç±»
UndoManager 1 5-10 2-5<br />
å®ä½“ç±» Circle 1 5-8 3-6<br />
æœåŠ¡ç±» RendererFactory 1 3-5 1-3</p>
<p>6.2 ç±»è®¾è®¡çº¦æŸ</p>
<p>1 ä¸å¯å˜æ€§ï¼šå€¼å¯¹è±¡åº”è®¾è®¡ä¸ºä¸å¯å˜</p>
<p>public final class Point {<br />
private final int x;<br />
private final int y;<br />
// åªæœ‰getteræ–¹æ³•<br />
}</p>
<p>2 æ„é€ è§„èŒƒï¼š<br />
â€¢ é¿å…è¿‡é•¿å‚æ•°åˆ—è¡¨ï¼ˆâ‰¤5ä¸ªï¼‰<br />
â€¢ å¤æ‚å¯¹è±¡ä½¿ç”¨Builderæ¨¡å¼</p>
<ol start="7" type="1">
<li>è®¾è®¡æ¨¡å¼åº”ç”¨è§„èŒƒ</li>
</ol>
<p>7.1 æ¨¡å¼é€‰ç”¨æ ‡å‡†</p>
<p>åœºæ™¯ é¦–é€‰æ¨¡å¼ æ›¿ä»£æ–¹æ¡ˆ ç¦ç”¨æƒ…å†µ<br />
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” å¯¹è±¡åˆ›å»º å·¥å‚æ–¹æ³• ç®€å•å·¥å‚
ç›´æ¥new<br />
è¡Œä¸ºæ‰©å±• è®¿é—®è€… ç­–ç•¥ ç»§æ‰¿<br />
çŠ¶æ€ç®¡ç† å¤‡å¿˜å½• çŠ¶æ€ æ ‡å¿—ä½</p>
<p>7.2 æ¨¡å¼å®ç°æ¨¡æ¿</p>
<p>å·¥å‚æ–¹æ³•ç¤ºä¾‹ï¼š</p>
<p>public interface RendererFactory {<br />
// æ ‡å‡†å·¥å‚æ–¹æ³•<br />
Renderer create();</p>
<pre><code>// å¸¦å‚æ•°çš„å˜ä½“                                                                                                                 
Renderer create(String config);                                                                                                 </code></pre>
<p>}</p>
<p>å‘½ä»¤æ¨¡å¼ç¤ºä¾‹ï¼š</p>
<p>public abstract class AbstractCommand implements Command {<br />
protected final List<Shape> shapes;</p>
<pre><code>// æ¨¡æ¿æ–¹æ³•                                                                                                                     
public final void execute() {                                                                                                   
    if (!canExecute()) throw new IllegalStateException();                                                                       
    doExecute();                                                                                                                
}                                                                                                                               
                                                                                                                                
protected abstract void doExecute();                                                                                            </code></pre>
<p>}</p>
<ol start="8" type="1">
<li>å¼‚å¸¸å¤„ç†è§„èŒƒ</li>
</ol>
<p>8.1 å¼‚å¸¸åˆ†ç±»</p>
<p>ç±»å‹ ç¤ºä¾‹ å¤„ç†æ–¹å¼<br />
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” ä¸šåŠ¡å¼‚å¸¸
InvalidShapeException å±•ç¤ºç»™ç”¨æˆ·<br />
ç³»ç»Ÿå¼‚å¸¸ RenderingException æ—¥å¿—è®°å½•åæ¢å¤<br />
è‡´å‘½é”™è¯¯ OutOfMemoryError ç»ˆæ­¢åº”ç”¨</p>
<p>8.2 å¼‚å¸¸å¤„ç†æ¨¡æ¿</p>
<p>try {<br />
renderer.drawShape(shape);<br />
} catch (RenderingException e) {<br />
LOGGER.error(â€œæ¸²æŸ“å¤±è´¥â€, e);<br />
fallbackRenderer.drawPlaceholder();<br />
} finally {<br />
renderer.cleanup();<br />
}</p>
<ol start="9" type="1">
<li>æ€§èƒ½è®¾è®¡è§„èŒƒ</li>
</ol>
<p>9.1 æ€§èƒ½æ•æ„Ÿåœºæ™¯</p>
<p>1 æ¸²æŸ“å¾ªç¯ï¼š</p>
<p>// é¿å…åœ¨æ¸²æŸ“å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡<br />
for (Shape shape : shapes) {<br />
shape.render(reusedRenderer);<br />
}</p>
<p>2 å†…å­˜ç¼“å­˜ï¼š</p>
<p>public class ShapeCache {<br />
private static final int MAX_SIZE = 100;<br />
private static LinkedHashMap&lt;Key, Shape&gt; cache =<br />
new LinkedHashMap&lt;&gt;(â€¦, 0.75f, true) {<br />
protected boolean removeEldestEntry(Map.Entry eldest) {<br />
return size() &gt; MAX_SIZE;<br />
}<br />
};<br />
}</p>
<p>9.2 å¹¶å‘æ§åˆ¶</p>
<p>1 çº¿ç¨‹å®‰å…¨çº§åˆ«ï¼š</p>
<p><span class="citation"
data-cites="ThreadSafe">@ThreadSafe</span><br />
public class GlobalConfig {<br />
// ä½¿ç”¨volatileä¿è¯å¯è§æ€§<br />
private volatile String renderMode;<br />
}</p>
<p>2 é”ç²’åº¦æ§åˆ¶ï¼š</p>
<p>public class ThreadSafeRenderer implements Renderer {<br />
private final Object lock = new Object();</p>
<pre><code>   public void drawCircle(...) {                                                                                                
       synchronized(lock) {                                                                                                     
           // å…³é”®åŒºä»£ç                                                                                                         
       }                                                                                                                        
   }                                                                                                                            </code></pre>
<p>}</p>
<ol start="10" type="1">
<li>æ–‡æ¡£åŒ–è§„èŒƒ</li>
</ol>
<p>10.1 ä»£ç æ³¨é‡Šæ ‡å‡†</p>
<p>1 ç±»æ³¨é‡Šï¼š</p>
/**<br />
* åœ†å½¢å›¾å½¢å®ç°<br />
*<br />
*
<p>
<b>çº¿ç¨‹å®‰å…¨ï¼š</b>æ­¤ç±»æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œçº¿ç¨‹å®‰å…¨
</p>
<pre><code>*                                                                                                                               
* @see Shape åŸºç¡€æ¥å£                                                                                                           
* @since 2.0                                                                                                                    
*/                                                                                                                              </code></pre>
<p>public final class Circle implements Shape {</p>
<p>2 æ–¹æ³•æ³¨é‡Šï¼š</p>
<p>/**<br />
* ç»˜åˆ¶åœ†å½¢<br />
* <span class="citation" data-cites="param">@param</span> radius
åŠå¾„(å¿…é¡»&gt;0)<br />
* <span class="citation" data-cites="throws">@throws</span>
IllegalArgumentException å¦‚æœåŠå¾„â‰¤0<br />
* <span class="citation" data-cites="throws">@throws</span>
RenderingException å½“åº•å±‚æ¸²æŸ“å¤±è´¥æ—¶<br />
*/<br />
public void drawCircle(int radius) {</p>
<p>10.2 è®¾è®¡å†³ç­–è®°å½•</p>
<p>1 ADRæ¨¡æ¿ï¼š</p>
<p># 1. ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ•´åˆæ—§ç‰ˆæ¸²æŸ“å™¨</p>
<p>## çŠ¶æ€<br />
å·²é‡‡çº³</p>
<p>## å†³ç­–å› ç´ <br />
- éœ€è¦æ”¯æŒé—ç•™ç³»ç»Ÿ<br />
- æœ€å°åŒ–ä¿®æ”¹ç°æœ‰ä»£ç <br />
- 20%æ€§èƒ½å¼€é”€å¯æ¥å—</p>
<p>## æ›¿ä»£æ–¹æ¡ˆ<br />
1. ç›´æ¥é‡å†™æ—§ç‰ˆä»£ç ï¼ˆé«˜é£é™©ï¼‰<br />
2. å¹¶è¡Œç»´æŠ¤ä¸¤å¥—ç³»ç»Ÿï¼ˆé«˜æˆæœ¬ï¼‰</p>
<p>é™„å½•Aï¼šæ¶æ„è´¨é‡æ£€æŸ¥è¡¨</p>
<p>1 [ ] æ‰€æœ‰æ¨¡å—ä¾èµ–å…³ç³»ç¬¦åˆåˆ†å±‚è§„èŒƒ<br />
2 [ ] å…³é”®æ¥å£æœ‰æ˜ç¡®çš„@implSpecè¯´æ˜<br />
3 [ ] æ€§èƒ½æ•æ„Ÿä»£ç ç»è¿‡ProfileréªŒè¯<br />
4 [ ] å¼‚å¸¸å¤„ç†è¦†ç›–æ‰€æœ‰å·²çŸ¥é”™è¯¯åœºæ™¯<br />
5 [ ] è®¾è®¡å†³ç­–å·²è®°å½•åœ¨ADRæ–‡æ¡£ä¸­</p>
<p>é™„å½•Bï¼šå‚è€ƒæ¶æ„</p>
<p>ğŸŒ† å‚è€ƒæ¶æ„å›¾</p>
<p>ç‰ˆæœ¬æ§åˆ¶ï¼š</p>
<p>â€¢ v1.0 2025-06-20 åˆå§‹ç‰ˆæœ¬<br />
â€¢ v1.1 2025-06-25 æ·»åŠ æ€§èƒ½è®¾è®¡è§„èŒƒ<br />
â€¢ v2.0 2025-06-27 é‡æ„åˆ†å±‚è§„èŒƒ</p>
<p>å½’æ¡£ä½ç½®ï¼šdocs/architecture/design-specification.md</p>
</body>
</html>
