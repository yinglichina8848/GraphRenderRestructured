<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSONExportVisitor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GraphRenderSystem</a> &gt; <a href="index.source.html" class="el_package">com.example.renderer.visitor</a> &gt; <span class="el_source">JSONExportVisitor.java</span></div><h1>JSONExportVisitor.java</h1><pre class="source lang-java linenums">package com.example.renderer.visitor;

/**
 * JSONExportVisitor实现了将图形导出为JSON格式的访问者。
 * 
 * &lt;p&gt;作为访问者模式(Visitor Pattern)的具体实现，它为每种图形类型提供了专门的visit方法，
 * 允许在不修改图形类的情况下添加新的导出操作。&lt;/p&gt;
 * 
 * &lt;p&gt;输出格式规范：
 * &lt;ul&gt;
 *   &lt;li&gt;圆形(circle): {&quot;type&quot;:&quot;circle&quot;, &quot;x&quot;:x, &quot;y&quot;:y, &quot;r&quot;:radius}&lt;/li&gt;
 *   &lt;li&gt;矩形(rectangle): {&quot;type&quot;:&quot;rectangle&quot;, &quot;x&quot;:x, &quot;y&quot;:y, &quot;w&quot;:width, &quot;h&quot;:height}&lt;/li&gt;
 *   &lt;li&gt;椭圆(ellipse): {&quot;type&quot;:&quot;ellipse&quot;, &quot;x&quot;:x, &quot;y&quot;:y, &quot;rx&quot;:xRadius, &quot;ry&quot;:yRadius}&lt;/li&gt;
 *   &lt;li&gt;三角形(triangle): {&quot;type&quot;:&quot;triangle&quot;, &quot;x1&quot;:x1, &quot;y1&quot;:y1, ..., &quot;y3&quot;:y3}&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;/p&gt;
 * 
 * &lt;p&gt;使用示例：
 * &lt;pre&gt;{@code
 * Shape circle = new Circle(10, 10, 5);
 * ExportVisitor visitor = new JSONExportVisitor();
 * circle.accept(visitor); // 输出JSON到标准输出
 * }&lt;/pre&gt;
 * &lt;/p&gt;
 * 
 * &lt;p&gt;设计考虑：
 * &lt;ul&gt;
 *   &lt;li&gt;线程安全：无共享状态，可多线程使用&lt;/li&gt;
 *   &lt;li&gt;性能：直接输出到标准输出，避免内存开销&lt;/li&gt;
 *   &lt;li&gt;扩展性：新增图形类型只需实现对应visit方法&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;/p&gt;
 * 
 * @see ExportVisitor 访问者接口
 * @see Shape#accept(ExportVisitor) 接受访问者的入口方法
 * @see &lt;a href=&quot;https://en.wikipedia.org/wiki/Visitor_pattern&quot;&gt;Visitor Pattern&lt;/a&gt;
 * @author liying
 * @author Aider+SillconFlow-DeepSeek-R1
 * @since 1.0
 * @version 1.0
 * @createdAt 2025-06-29
 * 
 * &lt;p&gt;JSON编码说明：
 * &lt;ul&gt;
 *   &lt;li&gt;所有输出使用UTF-8编码&lt;/li&gt;
 *   &lt;li&gt;数字值不添加引号&lt;/li&gt;
 *   &lt;li&gt;不进行JSON字符串转义（简单实现）&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;/p&gt;
 * 
 * &lt;p&gt;性能优化建议：
 * &lt;ul&gt;
 *   &lt;li&gt;对于大批量导出，考虑使用StringBuilder或JSON库&lt;/li&gt;
 *   &lt;li&gt;需要文件输出时可重定向System.out&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;/p&gt;
 */

import com.example.renderer.factory.Circle;
import com.example.renderer.factory.Rectangle;
import com.example.renderer.factory.Ellipse;
import com.example.renderer.factory.Triangle;

/**
 * JSON导出访问者实现类
 */
<span class="fc" id="L67">public class JSONExportVisitor implements ExportVisitor {</span>
    // JSON格式模板常量
    /**
     * 圆形JSON格式模板
     * 格式: {&quot;type&quot;:&quot;circle&quot;, &quot;x&quot;:x, &quot;y&quot;:y, &quot;r&quot;:radius}
     */
    private static final String CIRCLE_JSON = 
        &quot;{\&quot;type\&quot;:\&quot;circle\&quot;, \&quot;x\&quot;:%d, \&quot;y\&quot;:%d, \&quot;r\&quot;:%d}&quot;;
    private static final String RECTANGLE_JSON = 
        &quot;{\&quot;type\&quot;:\&quot;rectangle\&quot;, \&quot;x\&quot;:%d, \&quot;y\&quot;:%d, \&quot;w\&quot;:%d, \&quot;h\&quot;:%d}&quot;;
    private static final String ELLIPSE_JSON = 
        &quot;{\&quot;type\&quot;:\&quot;ellipse\&quot;, \&quot;x\&quot;:%d, \&quot;y\&quot;:%d, \&quot;rx\&quot;:%d, \&quot;ry\&quot;:%d}&quot;;
    private static final String TRIANGLE_JSON = 
        &quot;{\&quot;type\&quot;:\&quot;triangle\&quot;, \&quot;x1\&quot;:%d, \&quot;y1\&quot;:%d, \&quot;x2\&quot;:%d, \&quot;y2\&quot;:%d, \&quot;x3\&quot;:%d, \&quot;y3\&quot;:%d}&quot;;

    /**
     * 将圆形对象转换为JSON格式输出
     * 格式: {&quot;type&quot;:&quot;circle&quot;, &quot;x&quot;:x, &quot;y&quot;:y, &quot;r&quot;:radius}
     * 
     * @param c 要导出的圆形对象，不能为null
     * @throws NullPointerException 如果参数c为null
     * @throws IllegalArgumentException 如果半径值为负数
     * 
     * @author Aider+SillconFlow-DeepSeek-R1
     * @since 2025-06-29
     */
    @Override
    public void visitCircle(Circle c) {
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">        if (c.getR() &lt; 0) {</span>
<span class="nc" id="L96">            throw new IllegalArgumentException(&quot;圆的半径不能为负数&quot;);</span>
        }
<span class="fc" id="L98">        System.out.printf(CIRCLE_JSON + &quot;\n&quot;, c.getX(), c.getY(), c.getR());</span>
<span class="fc" id="L99">    }</span>

    /**
     * 将矩形对象转换为JSON格式输出
     * 
     * @param r 要导出的矩形对象，不能为null
     * @throws NullPointerException 如果参数r为null
     */
    /**
     * 将矩形对象转换为JSON格式输出
     * 格式: {&quot;type&quot;:&quot;rectangle&quot;, &quot;x&quot;:x, &quot;y&quot;:y, &quot;w&quot;:width, &quot;h&quot;:height}
     * 
     * @param r 要导出的矩形对象，不能为null
     * @throws NullPointerException 如果参数r为null
     * @throws IllegalArgumentException 如果宽度或高度为负数
     * 
     * @author Aider+SillconFlow-DeepSeek-R1
     * @since 2025-06-29
     */
    @Override
    public void visitRectangle(Rectangle r) {
<span class="pc bpc" id="L120" title="2 of 4 branches missed.">        if (r.getWidth() &lt; 0 || r.getHeight() &lt; 0) {</span>
<span class="nc" id="L121">            throw new IllegalArgumentException(&quot;矩形的宽度和高度不能为负数&quot;);</span>
        }
<span class="fc" id="L123">        System.out.printf(RECTANGLE_JSON + &quot;\n&quot;, r.getX(), r.getY(), r.getWidth(), r.getHeight());</span>
<span class="fc" id="L124">    }</span>

    /**
     * 将椭圆对象转换为JSON格式输出
     * 
     * &lt;p&gt;输出格式: {&quot;type&quot;:&quot;ellipse&quot;, &quot;x&quot;:x, &quot;y&quot;:y, &quot;rx&quot;:xRadius, &quot;ry&quot;:yRadius}&lt;/p&gt;
     * 
     * @param e 要导出的椭圆对象(不能为null)
     * @throws NullPointerException 如果椭圆对象为null
     * @throws IllegalArgumentException 如果椭圆宽度或高度为负数
     * 
     * @author Aider+SillconFlow-DeepSeek-R1
     * @since 2025-06-29
     */
    @Override
    public void visitEllipse(Ellipse e) {
<span class="pc bpc" id="L140" title="2 of 4 branches missed.">        if (e.getWidth() &lt; 0 || e.getHeight() &lt; 0) {</span>
<span class="nc" id="L141">            throw new IllegalArgumentException(&quot;椭圆的宽度和高度不能为负数&quot;);</span>
        }
<span class="fc" id="L143">        System.out.printf(ELLIPSE_JSON + &quot;\n&quot;, </span>
<span class="fc" id="L144">            e.getX(), e.getY(), e.getWidth()/2, e.getHeight()/2);</span>
<span class="fc" id="L145">    }</span>

    /**
     * 将三角形对象转换为JSON格式输出
     * &lt;p&gt;输出格式: {&quot;type&quot;:&quot;triangle&quot;, &quot;x1&quot;:x1, &quot;y1&quot;:y1, ..., &quot;y3&quot;:y3}&lt;/p&gt;
     * 
     * @param t 要导出的三角形对象(不能为null)
     * @throws NullPointerException 如果三角形对象为null
     * 
     * @author Aider+SillconFlow-DeepSeek-R1
     * @since 2025-06-29
     */
    @Override
    public void visitTriangle(Triangle t) {
<span class="fc" id="L159">        System.out.printf(TRIANGLE_JSON + &quot;\n&quot;,</span>
<span class="fc" id="L160">                t.getX1(), t.getY1(), t.getX2(), t.getY2(), t.getX3(), t.getY3());</span>
<span class="fc" id="L161">    }</span>


}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>