name: AI自动修复与发布

on:
  schedule:
    - cron: '0 * * * *'  # 每小时
  push:
    branches: [main]

jobs:
  build-and-ai-fix:
    runs-on: ubuntu-latest

    steps:
      - name: ⬇️ 检出仓库
        uses: actions/checkout@v4

      - name: ⚙️ 安装 Java 和 Node.js
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: 🧠 安装 aider CLI（或你自己的 AI 工具）
        run: |
          pip install aider-cli  # 如果你用的是 pip 安装
          aider --version || echo "验证 Aider 是否安装成功"

      - name: 🤖 启动 AI 自动改进 + 构建 + 发布
        run: |
          chmod +x ai_improve.sh
          ./aiimprove.sh

      - name: 🤖 启动 AI 自动修复 + 构建 + 发布
        run: |
          chmod +x aifix.sh
          ./aiimprove.sh

      - name: 📦 上传 AI 报告
        uses: actions/upload-artifact@v3
        with:
          name: ai-fix-report
          path: doc/ai_fix_suggestions.md

